{% extends 'base.html.twig' %}

{% block title %}Modifier la figure
{% endblock %}

{% block body %}
	<br>

	<section
		class="relative">

		<!-- Hero -->
		<div class="absolute inset-0">
			<img src="{{ asset('assets/images/image-cover.jpg') }}" class="w-full h-[400px] sm:h-[500px] md:h-[600px] object-cover brightness-75">
			<div class="absolute inset-0 bg-linear-to-b from-transparent to-white/80"></div>
		</div>

		<div class="relative z-10 container mx-auto px-4 sm:px-6 md:px-12 lg:px-20 xl:px-32 pt-20">
			<div class="bg-white rounded-xl shadow-lg max-w-4xl mx-auto overflow-hidden">

				{{ form_start(form, { attr: { novalidate: 'novalidate' } }) }}

				{# ================= IMAGE PRINCIPALE ================= #}
				<div class="bg-gray-100/60 relative rounded-xl overflow-hidden">

					<div id="featuredImageArea" class="border border-dashed border-gray-300 rounded-xl text-center cursor-pointer hover:border-blue-500 transition relative h-[459px]">

						{{ form_widget(form.featuredImage, {
                        attr: { class: 'hidden', id: 'featuredImage' }
                    }) }}

						{# Placeholder #}
						<div id="placeholder" class="flex flex-col items-center justify-center space-y-2 h-full
								                         {% if trick.featuredImage %}hidden{% endif %}">
							<h4 class="text-gray-600 font-medium">Cliquer ou glisser une image ici</h4>
							<p class="text-gray-400 text-sm">JPG / PNG — Max 2 MB</p>
						</div>

						{# Preview existante #}
						<div id="previewContainer" class="relative h-full {% if not trick.featuredImage %}hidden{% endif %}">

							<img id="imagePreview" src="{{ trick.featuredImage ? asset('uploads/tricks/' ~ trick.featuredImage) : '' }}" class="h-full w-full object-cover rounded-xl">

							<div class="absolute top-2 right-2 flex space-x-2">
								<button type="button" class="bg-green-600 text-white p-2 rounded-xl">
									<i class="bi bi-pen"></i>
								</button>

								<button type="button" id="deleteImageBtn" class="bg-red-600 text-white p-2 rounded-xl">
									<i class="bi bi-trash"></i>
								</button>

								<input type="hidden" name="delete_featured" id="delete_featured" value="0">
							</div>
						</div>
					</div>

					{{ form_errors(form.featuredImage) }}
				</div>

				<h1 class="text-2xl sm:text-3xl font-bold text-center my-8">
					Modifier la figure
				</h1>

				<div
					class="px-6 sm:px-10 py-8 space-y-8">

					{# ================= MEDIA SECONDAIRES ================= #}
					<input type="checkbox" id="collapseToggle" class="peer hidden">

					<label for="collapseToggle" class="block cursor-pointer px-4 py-2 bg-blue-600 text-white rounded text-center">
						Gérer les images et vidéos
					</label>

					<div class="max-h-0 peer-checked:max-h-[9999px] transition-all overflow-hidden">
						<div
							class="p-4 bg-gray-100 rounded-b space-y-8">

							{# IMAGES EXISTANTES #}
							<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
								{% for image in trick.images %}
									<div class="relative">
										<img src="{{ asset('uploads/tricks/' ~ image.content) }}" class="rounded-xl h-[150px] w-full object-cover">

										<button type="button" class="absolute top-2 right-2 bg-red-600 text-white p-1 rounded-xl delete-image" data-id="{{ image.id }}">
											<i class="bi bi-trash"></i>
										</button>
									</div>
								{% endfor %}
							</div>

							{# AJOUT NOUVELLES IMAGES #}
							<div>
								<div id="images-wrapper" class="grid grid-cols-3 gap-4 mt-4"></div>
								<button type="button" id="add-image" class="mt-4 px-4 py-2 bg-[#007CCB] text-white rounded-xl">
									Ajouter des images
								</button>
							</div>

							{# VIDEOS EXISTANTES #}
							<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-6">
								{% for video in trick.videos %}
									<div class="relative">
										<iframe src="{{ video.embedUrl }}" class="w-full h-[150px] rounded-xl"></iframe>

										<button type="button" class="absolute top-2 right-2 bg-red-600 text-white p-1 rounded-xl delete-video" data-id="{{ video.id }}">
											<i class="bi bi-trash"></i>
										</button>
									</div>
								{% endfor %}
							</div>

							{# AJOUT VIDEOS #}
							<div>
								<div id="videos-wrapper" class="grid grid-cols-3 gap-4 mt-4"></div>
								<button type="button" id="add-video" class="mt-4 px-4 py-2 bg-[#00A3D9] text-white rounded-xl">
									Ajouter des vidéos
								</button>
							</div>
						</div>
					</div>

					{# ================= FORMULAIRE ================= #}
					{{ form_row(form.title) }}
					{{ form_row(form.content) }}
					{{ form_row(form.category) }}

					<div class="flex justify-end">
						<button type="submit" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-full font-semibold">
							Enregistrer les modifications
						</button>
					</div>
				</div>

				{{ form_end(form, { render_rest: false }) }}

			</div>
		</div>

		<div class="h-20"></div>
	</section>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('js/addFeaturedImage.js') }}"></script>
	<script src="{{ asset('js/addImages.js') }}"></script>
	<script src="{{ asset('js/addVideos.js') }}"></script>
	<script src="{{ asset('js/deleteMedia.js') }}"></script>
{% endblock %}
