{# templates/profile/tricks/add.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Ajouter une figure
{% endblock %}

{% block body %}
	<br>

	<section
		class="relative">
		<!-- Hero background -->
		<div class="absolute inset-0">
			<img src="{{ asset('assets/images/image-cover.jpg') }}" alt="Hero" class="w-full h-[400px] sm:h-[500px] md:h-[600px] object-cover brightness-75">
			<div class="absolute inset-0 bg-linear-to-b from-transparent to-white/80"></div>
		</div>

		<!-- Centered card -->
		<div class="relative z-10 container mx-auto px-4 sm:px-6 md:px-12 lg:px-20 xl:px-32 pt-20">
			<div class="bg-white rounded-xl shadow-lg max-w-4xl mx-auto overflow-hidden">
				{{ form_start(form, { attr: {novalidate: 'novalidate'} }) }}

				{# Featured image #}
				<div class="bg-gray-100/60 relative rounded-xl overflow-hidden">
					<div id="featuredImageArea" class="border border-dashed border-gray-300 rounded-xl text-center cursor-pointer hover:border-blue-500 transition relative h-[459px]">
						{{ form_widget(form.featuredImage, { attr: { class: 'hidden', id: 'featuredImage' } }) }}

						<div id="placeholder" class="flex flex-col items-center justify-center space-y-2 {% if featuredImageUrl is defined %}hidden{% endif %} h-full">
							<h4 class="text-gray-600 font-medium text-sm sm:text-base">Cliquer ou glisser une image ici</h4>
							<p class="text-gray-400 text-xs sm:text-sm">JPG / PNG — Max 2 MB</p>
						</div>

						<div id="previewContainer" class="relative {% if featuredImageUrl is not defined %}hidden{% endif %} h-full">
							<img id="imagePreview" src="{{ featuredImageUrl ?? '' }}" class="h-full w-full object-cover rounded-xl">
							<div class="absolute top-2 right-2 flex space-x-2">
								<button class="bg-green-600 text-white p-2 shadow hover:bg-green-700 transition rounded-xl">
									<i class="bi bi-pen"></i>
								</button>
								<button id="deleteImageBtn" type="button" class="bg-red-600 text-white p-2 shadow hover:bg-red-700 transition rounded-xl">
									<i class="bi bi-trash"></i>
								</button>
								<input type="hidden" name="delete_featured" id="delete_featured" value="0">
							</div>
						</div>
					</div>
					{{ form_errors(form.featuredImage) }}
					<p id="featuredImageMsg" class="text-red-500 text-sm"></p>
				</div>
				<br>
				<h1 class="text-2xl sm:text-3xl font-bold text-center mb-4 sm:mb-8">Ajouter une figure</h1>
				<div class="px-6 sm:px-10 py-8 sm:py-10 space-y-6">


					<div
						class="w-full">

						<!-- Checkbox invisible pour contrôler l'état -->
						<input
						type="checkbox" id="collapseToggle" class="peer hidden">

						<!-- Bouton collapse simple -->
						<label for="collapseToggle" class="block cursor-pointer px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 w-full text-center font-medium transition">
							Ajouter des images et vidéos secondaires
						</label>

						<!-- Contenu collapse auto-expandable -->
						<div class="max-h-0 overflow-hidden peer-checked:max-h-[9999px] transition-all duration-300 ease-in-out">
							<div
								class="p-4 bg-gray-100 border border-gray-300 rounded-b space-y-8">

								{# Secondary Images #}
								<div class="mt-4">
									<div id="images-wrapper" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
									<template id="image-template">
										<div class="image-item item-card border-2 border-dotted relative">
											<button type="button" class="remove-image absolute top-2 right-2 bg-red-600 text-white p-1 rounded-xl hover:bg-red-700">
												<i class="bi bi-trash"></i>
											</button>
											<input type="file" class="image-input hidden" accept="image/*"/>
											<div class="placeholder w-full h-full flex flex-col items-center justify-center text-center text-gray-500 pointer-events-none">
												<h4 class="text-sm font-medium">Cliquer ou glisser une image ici</h4>
												<p class="text-xs">JPG / PNG — Max 2 MB</p>
											</div>
											<img src="" class="image-preview hidden w-full h-[150px] object-cover rounded-xl border mt-3">
										</div>
									</template>
									<div class="mt-4">
										<button type="button" id="add-image" class="px-4 py-2 bg-[#007CCB] hover:bg-[#005F9E] text-white rounded-xl">
											Ajouter des images
										</button>
									</div>
								</div>

								{# Videos #}
								<div class="mt-8">
									<div id="videos-wrapper" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 mt-4"></div>
									<template id="video-template">
										<div class="video-item item-card relative">
											<button type="button" class="remove-video absolute top-2 right-2 bg-red-600 text-white p-1 rounded-xl hover:bg-red-700">
												<i class="bi bi-trash"></i>
											</button>
											<input type="text" class="video-input block w-full rounded-xl border-gray-200 p-2 text-sm" placeholder="https://youtu.be/...">
											<div class="video-preview hidden mt-3 w-full">
												<iframe class="w-full h-[150px] rounded-xl border" src="" frameborder="0" allowfullscreen></iframe>
											</div>
										</div>
									</template>
									<div class="mt-4">
										<button type="button" id="add-video" class="px-4 py-2 bg-[#00A3D9] hover:bg-[#0082B0] text-white rounded-xl">
											Ajouter des vidéos
										</button>
									</div>
								</div>

							</div>
						</div>

					</div>


					{# Title #}
					<div>

						<div class="mt-1">
							{{ form_widget(form.title) }}
						</div>
						{{ form_errors(form.title) }}
					</div>

					{# Content #}
					<div>

						<div class="mt-1">
							{{ form_widget(form.content) }}
						</div>
						{{ form_errors(form.content) }}
					</div>

					{# Category #}
					<div>

						<div class="mt-1">
							{{ form_widget(form.category) }}
						</div>
						{{ form_errors(form.category) }}
					</div>


					{# Submit #}
					<div class="mt-6 flex justify-end">
						<button type="submit" class="px-4 sm:px-5 py-2 sm:py-3 bg-[#007CCB] hover:bg-[#005F9E] text-white rounded-full font-semibold text-sm sm:text-base">
							Ajouter la figure
						</button>
					</div>
				</div>

				{{ form_end(form, { render_rest: false }) }}
			</div>
		</div>


		<div class="h-20"></div>
	</section>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('js/addFeaturedImage.js') }}"></script>
	<script src="{{ asset('js/addImages.js') }}"></script>
	<script src="{{ asset('js/addVideos.js') }}"></script>

{% endblock %}
