{% extends 'base.html.twig' %}

{% block title %}Ajouter une figure
{% endblock %}

{% block body %}
	<section
		class="relative pb-12">
		<!-- Hero background -->
		<div class="absolute inset-0">
			<img src="{{ asset('assets/images/image-cover.jpg') }}" alt="Hero" class="w-full h-[400px] sm:h-[500px] md:h-[600px] object-cover brightness-75">
			<div class="absolute inset-0 bg-linear-to-b from-transparent to-white/80"></div>
		</div>

		<!-- Centered card -->
		<div class="relative z-10 container mx-auto px-4 sm:px-6 md:px-12 lg:px-20 xl:px-32 pt-20">
			<div class="bg-white rounded-xl shadow-lg max-w-6xl mx-auto overflow-hidden pb-12">

				<h1 class="text-3xl font-bold text-center mb-8">Ajouter une nouvelle figure</h1>

				{{ form_start(form, { attr: { novalidate: 'novalidate', enctype: 'multipart/form-data' } }) }}

				{# Featured Image #}
				<div
					id="image-container" class="w-full aspect-video border-2 border-dashed border-gray-300 rounded-xl flex items-center justify-center cursor-pointer overflow-hidden relative transition-all duration-300 hover:border-blue-400 hover:bg-gray-50 bg-[#E5E6EA]">

					<!-- Preview -->
					<img
					id="image-preview" class="absolute inset-0 w-full h-full object-cover object-center opacity-0 transition-opacity duration-300"/>

					<!-- Placeholder -->
					<span id="image-placeholder" class="absolute text-gray-500 transition-opacity duration-300">
						Cliquez pour ajouter une image
					</span>

					<!-- Champ file Symfony -->
					{{ form_widget(form.featuredImage, {
                    'attr': {
                        'class': 'absolute w-full h-full opacity-0 cursor-pointer',
                        'accept': 'image/png, image/jpeg, image/webp'
                    }
                }) }}

					<!-- Actions Edit / Delete -->
					<div class="absolute top-2 right-2 flex gap-2 opacity-0 transition-opacity duration-300" id="image-actions">
						<button type="button" id="edit-image" class="bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600">Edit</button>
						<button type="button" id="delete-image" class="bg-red-500 text-white px-2 py-1 rounded text-sm hover:bg-red-600">Delete</button>
					</div>

					<!-- Affichage des erreurs Symfony -->
					<div id="image-error" class="absolute bottom-2 left-2 text-red-500 text-sm">
						{{ form_errors(form.featuredImage) }}
					</div>
				</div>

				<!-- MEDIA REPEATER -->
				<div class=" px-4 md:px-8 lg:px-8 ">
					<div
						id="media-wrapper" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-6 gap-4 pb-4">

						<!-- Images -->
						<div id="repeater-image-container" class="contents"></div>

						<!-- Vidéos -->
						<div id="repeater-video-container" class="contents"></div>

						<!-- Boutons ajout -->
						<div class="col-span-full flex justify-center gap-4">
							<button id="add-image" type="button" class="px-4 py-2 bg-[#2789DC] text-white rounded hover:bg-[#1A5EA0]">
								<i class="bi bi-plus-square-fill"></i>
								Ajouter une image
							</button>

							<button id="add-video" type="button" class="px-4 py-2 bg-[#2789DC] text-white rounded hover:bg-[#1A5EA0]">
								<i class="bi bi-plus-square-fill"></i>
								Ajouter une vidéo
							</button>
						</div>
					</div>

					<!-- TEMPLATE IMAGE -->
					<div id="media-template" class="media-item hidden">
						<img class="image-preview hidden mb-3 w-full h-40 object-cover rounded border">

						<div class="image-placeholder bg-gray-100 w-full h-40 flex items-center justify-center rounded border mb-3">
							<i class="bi bi-image text-2xl text-gray-400"></i>
						</div>

						<div class="media-actions flex items-center justify-end gap-2 w-full">
							<button type="button" class="edit-image-btn media-btn w-12 h-12 border-2 border-gray-300 text-gray-400
																																																																																																																																																																															                rounded-lg flex items-center justify-center hover:bg-gray-100 transition">
								<i class="bi bi-pencil text-xl"></i>
							</button>

							<button type="button" class="remove-media w-12 h-12 bg-red-700 text-white rounded-lg
																																																																																																																																																																															                flex items-center justify-center hover:bg-red-800">
								<i class="bi bi-trash"></i>
							</button>
						</div>
					</div>

					<!-- TEMPLATE VIDEO -->
					<div id="video-template" class="media-item hidden">
						<div class="video-preview hidden mb-3">
							<iframe class="w-full aspect-video rounded border" src="" frameborder="0" allowfullscreen></iframe>
						</div>
						<div class="video-placeholder bg-gray-100 w-full h-40 flex items-center justify-center rounded border mb-3">
							<i class="bi bi-play-btn text-3xl text-gray-400"></i>
						</div>

						<div class="video-actions flex items-center justify-end gap-2 w-full">
							<button type="button" class="edit-video-btn media-btn w-12 h-12 border-2 border-gray-300 text-gray-400
																																																																																																																																																																															                rounded-lg flex items-center justify-center hover:bg-gray-100 transition">
								<i class="bi bi-pencil text-xl"></i>
							</button>

							<button type="button" class="remove-video w-12 h-12 bg-red-700 text-white rounded-lg
																																																																																																																																																																															                flex items-center justify-center hover:bg-red-800">
								<i class="bi bi-trash"></i>
							</button>
						</div>
					</div>

					<!-- MODAL EDIT IMAGE -->
					<div id="editImageModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 pointer-events-none transition-opacity duration-300">
						<div class="bg-white rounded-lg shadow-lg p-6 w-96 relative transform scale-95 transition-transform duration-300">
							<button type="button" id="closeEditImageModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">&times;</button>
							<h2 class="text-xl font-bold mb-4">Éditer l'image</h2>
							<input type="file" accept="image/png,image/jpeg,image/webp" class="border rounded p-2 w-full" id="modalImageInput">
							<button type="button" class="mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" id="modalImageSaveBtn">
								Valider
							</button>
						</div>
					</div>

					<!-- MODAL EDIT VIDEO -->
					<div id="editVideoModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 pointer-events-none transition-opacity duration-300">
						<div class="bg-white rounded-lg shadow-lg p-6 w-96 relative transform scale-95 transition-transform duration-300">
							<button type="button" id="closeEditVideoModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">&times;</button>
							<h2 class="text-xl font-bold mb-4">Éditer la vidéo</h2>
							<input type="text" placeholder="URL YouTube" class="border rounded p-2 w-full" id="modalVideoInput">
							<button type="button" class="mt-4 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600" id="modalVideoSaveBtn">
								Valider
							</button>
						</div>
					</div>

				</div>

				<!-- END MEDIA REPEATER -->


				<!-- CAROUSEL MEDIA REPEATER -->
				<div class="relative w-full overflow-hidden">
					<div
						id="media-wrapper" class="flex transition-transform duration-300">

						<!-- TEMPLATE IMAGE -->
						<div id="media-template" class="media-item hidden">
							<img class="image-preview hidden mb-3 w-full h-40 object-cover rounded border">

							<div class="image-placeholder bg-gray-100 w-full h-40 flex items-center justify-center rounded border mb-3">
								<i class="bi bi-image text-2xl text-gray-400"></i>
							</div>

							<div class="media-actions flex items-center justify-end gap-2 w-full">
								<button type="button" class="edit-image-btn media-btn w-12 h-12 border-2 border-gray-300 text-gray-400
																																																																																																																																																																																                rounded-lg flex items-center justify-center hover:bg-gray-100 transition">
									<i class="bi bi-pencil text-xl"></i>
								</button>

								<button type="button" class="remove-media w-12 h-12 bg-red-700 text-white rounded-lg
																																																																																																																																																																																                flex items-center justify-center hover:bg-red-800">
									<i class="bi bi-trash"></i>
								</button>
							</div>
						</div>

						<!-- TEMPLATE VIDEO -->
						<div id="video-template" class="media-item w-1/3 p-4 border bg-white rounded-xl shadow-sm hidden">
							<div class="video-placeholder bg-gray-100 w-full h-40 flex items-center justify-center rounded border mb-3">
								<input type="text" class="video-input w-full px-2 py-1" placeholder="URL YouTube">
							</div>
							<video class="video-preview hidden mb-3 w-full h-40 object-cover rounded border" controls></video>
							<iframe class="youtube-preview hidden w-full h-40 rounded" frameborder="0" allowfullscreen></iframe>
							<div class="media-actions flex items-center gap-2">
								<input type="file" class="video-file-input" accept="video/*">
								<button class="remove-media bg-red-700 text-white px-4 py-2 rounded hover:bg-red-800">Supprimer</button>
							</div>
						</div>

					</div>

					<!-- NAVIGATION -->
					<button type="button" id="prev" class="absolute left-2 top-1/2 -translate-y-1/2 bg-white p-2 rounded-full shadow">
						<i class="bi bi-chevron-left"></i>
					</button>
					<button type="button" id="next" class="absolute right-2 top-1/2 -translate-y-1/2 bg-white p-2 rounded-full shadow">
						<i class="bi bi-chevron-right"></i>
					</button>
				</div>


				<br>

				<div
					class=" px-4 md:px-8 lg:px-24 ">

					{# Title, content, category #}
					<div class="mb-4">
						{{ form_widget(form.title, { attr: { class: 'w-full border-b pb-2 text-gray-700 focus:outline-none focus:border-blue-400' } }) }}
						<div class="text-red-500 text-sm">{{ form_errors(form.title) }}</div>
					</div>

					<div class="mb-4">
						{{ form_widget(form.content) }}
						<div class="text-red-500 text-sm">{{ form_errors(form.content) }}</div>
					</div>

					<div class="mb-4">
						{{ form_widget(form.category) }}
						<div class="text-red-500 text-sm">{{ form_errors(form.category) }}</div>
					</div>


					<div class="flex justify-end">
						<button type="submit" class="px-4 py-2 bg-[#007CCB] hover:bg-[#005F9E] text-white rounded-full font-semibold">
							Ajouter la figure
						</button>
					</div>


				</div>


				{{ form_end(form) }}

			</div>
		</div>
	</section>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('js/hero.js') }}"></script>
	<script src="{{ asset('js/modal.js') }}"></script>

{% endblock %}
